<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Memorizando</title>
  <style>
    body {
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
      padding: 5vw;
      line-height: 1.6;
      font-size: 1.2rem;
      background-color: #f9f9f9;
      color: #333;
    }

    h1 {
      font-size: 1.6rem;
      margin-bottom: 1rem;
    }

    label, select, button {
      font-size: 1rem;
    }

    #output {
      margin-top: 1.5rem;
      font-size: 1.4rem;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    #buttons {
      margin-top: 1rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    button {
      padding: 0.6rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      background-color: #007acc;
      color: white;
      cursor: pointer;
    }

    button:disabled {
      background-color: #aaa;
      cursor: default;
    }

    #contador {
      margin-top: 0.8rem;
      font-size: 1rem;
      color: #555;
    }

    select {
      max-width: 100%;
      padding: 0.4rem;
    }
  </style>
</head>
<body>
  <h1>Trabajando la memoria.</h1>

  <div>
    <label><input type="radio" name="tipo" value="articulos" checked> Art√≠culos</label>
    <label><input type="radio" name="tipo" value="textos"> Textos</label>
  </div>

  <label for="selector">Selecciona:</label>
  <select id="selector"></select>

  <div id="output"></div>

  <div id="buttons">
    <button id="nextButton" disabled>Siguiente palabra</button>
    <button id="resetButton" disabled>Reiniciar</button>
  </div>

  <div id="contador"></div>

  <script>
    let textos = {};
    let textosTxt = {};
    let palabras = [];
    let currentIndex = 1;
    let modo = 'articulos';
    let intervalo = null;

    async function cargarTextos() {
      try {
        const response = await fetch('articulos.json');
        textos = await response.json();
        poblarSelector();
      } catch (error) {
        alert("Error al cargar el archivo articulos.json");
        console.error(error);
      }
    }

    async function cargarTextosTxt() {
      if (Object.keys(textosTxt).length > 0) return;
      const response = await fetch('textos.txt');
      const contenido = await response.text();

      const bloques = contenido.split(/TEXTO \d+: /).slice(1);
      bloques.forEach(bloque => {
        const [tituloLinea, ...cuerpoLineas] = bloque.split('\n');
        const titulo = tituloLinea.trim();
        const cuerpo = cuerpoLineas.join(' ').trim();
        textosTxt[titulo] = cuerpo;
      });
    }

    function poblarSelector() {
      const selector = document.getElementById('selector');
      selector.innerHTML = '';

      Object.keys(textos).forEach(id => {
        const option = document.createElement('option');
        option.value = id;
        option.textContent = `${id}`;
        selector.appendChild(option);
      });

      selector.onchange = () => prepararTexto(selector.value);

      if (selector.options.length > 0) {
        prepararTexto(selector.options[0].value);
      }
    }

    function poblarSelectorTextos() {
      const selector = document.getElementById('selector');
      selector.innerHTML = '';

      Object.keys(textosTxt).forEach(titulo => {
        const option = document.createElement('option');
        option.value = titulo;
        option.textContent = titulo;
        selector.appendChild(option);
      });

      selector.onchange = () => prepararTextoTxt(selector.value);

      if (selector.options.length > 0) {
        prepararTextoTxt(selector.options[0].value);
      }
    }

    function prepararTexto(id) {
      if (intervalo) clearInterval(intervalo);
      const textoPlano = textos[id];
      palabras = textoPlano.split(/(\s+|\n)/g).filter(p => p.trim() !== '' || p === '\n');
      currentIndex = 1;
      mostrarPalabras();
      document.getElementById('nextButton').disabled = false;
      document.getElementById('nextButton').textContent = "Siguiente palabra";
      document.getElementById('resetButton').disabled = false;
    }

    function mostrarPalabras() {
      const visibles = palabras
        .slice(0, currentIndex)
        .map(p => p === '\n' ? '<br>' : p);
      document.getElementById('output').innerHTML = visibles.join(' ');

      actualizarContador();

      if (currentIndex >= palabras.length) {
        document.getElementById('nextButton').textContent = "Texto completo";
        document.getElementById('nextButton').disabled = true;
      }
    }

    function actualizarContador() {
      const total = palabras.filter(p => p !== '\n').length;
      const mostradas = palabras.slice(0, currentIndex).filter(p => p !== '\n').length;
      document.getElementById('contador').textContent = `${mostradas} / ${total} palabras mostradas`;
    }

    document.getElementById('nextButton').addEventListener('click', () => {
      if (modo === 'articulos') {
        while (currentIndex < palabras.length) {
          currentIndex++;
          if (palabras[currentIndex - 1] !== '\n') break;
        }
        mostrarPalabras();
      }
    });

    document.getElementById('resetButton').addEventListener('click', () => {
      if (intervalo) clearInterval(intervalo);
      if (modo === 'articulos') {
        currentIndex = 1;
        mostrarPalabras();
        document.getElementById('nextButton').disabled = false;
        document.getElementById('nextButton').textContent = "Siguiente palabra";
      } else if (modo === 'textos') {
        prepararTextoTxt(document.getElementById('selector').value);
      }
    });

function prepararTextoTxt(titulo) {
  if (intervalo) clearInterval(intervalo);
  const texto = textosTxt[titulo];
  const palabrasArray = texto.match(/\S+|\n/g) || [];
  const output = document.getElementById('output');
  output.innerHTML = '';
  let i = 0;
  let contadorPalabras = 0;

  intervalo = setInterval(() => {
    if (i >= palabrasArray.length) {
      clearInterval(intervalo);
      return;
    }

    let palabra = palabrasArray[i++];
    const finFrase = /[.?!]/.test(palabra.slice(-1));
    const salto = finFrase || contadorPalabras === 9;

    output.innerHTML += palabra + (salto ? '<br>' : ' ');
    contadorPalabras = salto ? 0 : contadorPalabras + 1;

    document.getElementById('contador').textContent = `${i} / ${palabrasArray.length} palabras`;
  }, 1000);
}


    document.querySelectorAll('input[name="tipo"]').forEach(radio => {
      radio.addEventListener('change', async (e) => {
        if (intervalo) clearInterval(intervalo);
        modo = e.target.value;
        document.getElementById('output').innerHTML = '';
        document.getElementById('contador').textContent = '';
        if (modo === 'articulos') {
          poblarSelector();
          document.getElementById('nextButton').disabled = false;
        } else {
          await cargarTextosTxt();
          poblarSelectorTextos();
          document.getElementById('nextButton').disabled = true; // solo auto
        }
      });
    });

    cargarTextos();
  </script>
</body>
</html>
